(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class tt{roomWidth=200;roomHeight=200;calculateVirtualObjects(t,e,r){const s=[],i=[],u={position:{x:0,y:0}};return e[0]&&i.push({position:{x:0,y:-this.roomHeight},mirrors:e,depth:1,opacity:.7}),e[1]&&i.push({position:{x:this.roomWidth,y:0},mirrors:e,depth:1,opacity:.7}),e[2]&&i.push({position:{x:0,y:this.roomHeight},mirrors:e,depth:1,opacity:.7}),e[3]&&i.push({position:{x:-this.roomWidth,y:0},mirrors:e,depth:1,opacity:.7}),i.forEach(o=>{if(o.depth===0)return;let a;o.position.y<0?a="top":o.position.x>0?a="right":o.position.y>0?a="bottom":a="left";const d=this.getMirrorPosition(a,u.position);s.push(this.reflectAcrossMirror(t.triangle.position,"triangle",a,o.depth,d),this.reflectAcrossMirror(t.viewer.position,"viewer",a,o.depth,d))}),{virtualObjects:s,virtualRooms:i}}getMirrorPosition(t,e){switch(t){case"top":return e.y;case"bottom":return e.y+this.roomHeight;case"left":return e.x;case"right":return e.x+this.roomWidth}}reflectAcrossMirror(t,e,r,s,i,u){const o={...t};let a=u?.flippedX||!1,d=u?.flippedY||!1;switch(r){case"top":const C=i??0;o.y=2*C-t.y,d=!d;break;case"right":const S=i??this.roomWidth;o.x=2*S-t.x,a=!a;break;case"bottom":const x=i??this.roomHeight;o.y=2*x-t.y,d=!d;break;case"left":const B=i??0;o.x=2*B-t.x,a=!a;break}return{id:`${e}-d${s}-${r}`,sourceType:e,position:o,flippedX:a,flippedY:d,depth:s,opacity:1-s*.3}}calculateRayPath(t,e,r){const s=[];if(s.push(t.position),t.depth===1){const i=t.id.split("-")[2],u=this.getRayMirrorIntersection(t.position,e,i);u&&s.push(u)}else t.depth>1;return s.push(e),s}getRayMirrorIntersection(t,e,r){switch(r){case"top":const s=-t.y/(e.y-t.y);if(s>=0&&s<=1){const a=t.x+s*(e.x-t.x);if(a>=0&&a<=this.roomWidth)return{x:a,y:0}}break;case"right":const i=(this.roomWidth-t.x)/(e.x-t.x);if(i>=0&&i<=1){const a=t.y+i*(e.y-t.y);if(a>=0&&a<=this.roomHeight)return{x:this.roomWidth,y:a}}break;case"bottom":const u=(this.roomHeight-t.y)/(e.y-t.y);if(u>=0&&u<=1){const a=t.x+u*(e.x-t.x);if(a>=0&&a<=this.roomWidth)return{x:a,y:this.roomHeight}}break;case"left":const o=-t.x/(e.x-t.x);if(o>=0&&o<=1){const a=t.y+o*(e.y-t.y);if(a>=0&&a<=this.roomHeight)return{x:0,y:a}}break}return null}}class et{state;reflectionEngine;selectedTouchAreas=new Set;submissionResult=null;constructor(){this.state={mode:"edit",room:{width:200,height:200,mirrors:[!1,!1,!1,!1]},objects:{triangle:{position:{x:100,y:75}},viewer:{position:{x:100,y:175}}},touchAreas:[],content:{problemText:"",explanationText:"",correctFeedback:"",incorrectFeedback:""},selectedVirtualObjectForRay:null,maxReflectionDepth:3},this.reflectionEngine=new tt}setMode(t){this.state.mode=t,this.selectedTouchAreas.clear(),this.submissionResult=null}getMode(){return this.state.mode}getObjects(){return{triangle:{...this.state.objects.triangle.position},viewer:{...this.state.objects.viewer.position}}}moveObject(t,e){if(this.state.mode!=="edit")return;const r=20,s={x:Math.max(r,Math.min(this.state.room.width-r,e.x)),y:Math.max(r,Math.min(this.state.room.height-r,e.y))};this.state.objects[t].position=s}getObjectPosition(t){return{...this.state.objects[t].position}}addTouchArea(t){if(this.state.mode!=="edit")return"";const e=`touch-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r={id:e,position:t||{x:400,y:400},isCorrect:!0,radius:30};return this.state.touchAreas.push(r),e}moveTouchArea(t,e){if(this.state.mode!=="edit")return;const r=this.state.touchAreas.find(s=>s.id===t);r&&(r.position=e)}setTouchAreaCorrect(t,e){if(this.state.mode!=="edit")return;const r=this.state.touchAreas.find(s=>s.id===t);r&&(r.isCorrect=e)}deleteTouchArea(t){this.state.mode==="edit"&&(this.state.touchAreas=this.state.touchAreas.filter(e=>e.id!==t))}getAllTouchAreas(){return[...this.state.touchAreas]}setMirror(t,e){if(this.state.mode!=="edit")return;const r=this.getMirrorIndex(t);this.state.room.mirrors[r]=e}toggleMirror(t){if(this.state.mode!=="edit")return;const e=this.getMirrorIndex(t);this.state.room.mirrors[e]=!this.state.room.mirrors[e]}getMirrors(){return{top:this.state.room.mirrors[0],right:this.state.room.mirrors[1],bottom:this.state.room.mirrors[2],left:this.state.room.mirrors[3]}}getMirrorIndex(t){switch(t){case"top":return 0;case"right":return 1;case"bottom":return 2;case"left":return 3}}setProblemText(t){this.state.mode==="edit"&&(this.state.content.problemText=t)}setExplanationText(t){this.state.mode==="edit"&&(this.state.content.explanationText=t)}setCorrectFeedback(t){this.state.mode==="edit"&&(this.state.content.correctFeedback=t)}setIncorrectFeedback(t){this.state.mode==="edit"&&(this.state.content.incorrectFeedback=t)}getContent(){return{...this.state.content}}selectVirtualObjectForRay(t){this.state.mode==="edit"&&(this.state.selectedVirtualObjectForRay=t)}getSelectedVirtualObject(){return this.state.selectedVirtualObjectForRay}getVirtualObjects(){const t=this.reflectionEngine.calculateVirtualObjects(this.state.objects,this.state.room.mirrors,this.state.maxReflectionDepth);if(this.state.selectedVirtualObjectForRay){const e=t.virtualObjects.find(r=>r.id===this.state.selectedVirtualObjectForRay);e&&(e.rayPath=this.reflectionEngine.calculateRayPath(e,this.state.objects.viewer.position,this.state.room.mirrors))}return t}getVirtualRooms(){return this.reflectionEngine.calculateVirtualObjects(this.state.objects,this.state.room.mirrors,this.state.maxReflectionDepth).virtualRooms}selectTouchArea(t){this.state.mode==="play"&&this.selectedTouchAreas.add(t)}deselectTouchArea(t){this.state.mode==="play"&&this.selectedTouchAreas.delete(t)}getSelectedTouchAreas(){return Array.from(this.selectedTouchAreas)}submitAnswer(){if(this.state.mode!=="play")return{isCorrect:!1,selectedCorrect:[],selectedIncorrect:[],missedCorrect:[],message:"Can only submit in play mode"};const t=[],e=[],r=[];for(const o of this.selectedTouchAreas){const a=this.state.touchAreas.find(d=>d.id===o);a&&(a.isCorrect?t.push(o):e.push(o))}for(const o of this.state.touchAreas)o.isCorrect&&!this.selectedTouchAreas.has(o.id)&&r.push(o.id);const s=e.length===0&&r.length===0,i=s?this.state.content.correctFeedback||"Correct!":this.state.content.incorrectFeedback||"Try again!",u={isCorrect:s,selectedCorrect:t,selectedIncorrect:e,missedCorrect:r,message:i};return this.submissionResult=u,u}resetPuzzle(){this.selectedTouchAreas.clear(),this.submissionResult=null}storeSubmissionResult(t){this.submissionResult=t}getSubmissionResult(){return this.submissionResult}clearSubmissionResult(){this.submissionResult=null}exportJSON(){return JSON.stringify(this.state,null,2)}importJSON(t){try{const e=JSON.parse(t);e.mode&&e.room&&e.objects&&e.touchAreas&&e.content&&(this.state=e,this.selectedTouchAreas.clear())}catch(e){console.error("Failed to import JSON:",e)}}validateConfiguration(){const t=[];this.state.touchAreas.length===0&&t.push("No touch areas defined - puzzle cannot be played"),!this.state.touchAreas.some(i=>i.isCorrect)&&this.state.touchAreas.length>0&&t.push("No correct touch areas defined - puzzle has no solution"),this.state.touchAreas.length>=5&&t.push("5+ touch areas - puzzle is getting too complex");const r=t.length===0||t.length===1&&t[0].includes("getting too complex"),s=t.join(" â€¢ ");return{isValid:r,message:s}}isPointInRoom(t){return t.x>=0&&t.x<=this.state.room.width&&t.y>=0&&t.y<=this.state.room.height}transformToCanvas(t){return{x:t.x+300,y:t.y+300}}transformToRoom(t){return{x:t.x-300,y:t.y-300}}getState(){return this.state}}const l=new et;function K(){const c=document.getElementById("edit-mode-btn"),t=document.getElementById("play-mode-btn");c?.addEventListener("click",()=>{l.setMode("edit"),Y(),M()}),t?.addEventListener("click",()=>{l.setMode("play"),Y(),M()});const e=document.getElementById("export-btn"),r=document.getElementById("import-btn"),s=document.getElementById("import-input");e?.addEventListener("click",()=>{const b=l.exportJSON();rt(b,"puzzle.json")}),r?.addEventListener("click",()=>{s?.click()}),s?.addEventListener("change",b=>{const w=b.target.files?.[0];if(w){const m=new FileReader;m.onload=h=>{const g=h.target?.result;l.importJSON(g),D()},m.readAsText(w)}});const i={top:document.getElementById("mirror-top"),right:document.getElementById("mirror-right"),bottom:document.getElementById("mirror-bottom"),left:document.getElementById("mirror-left")};Object.entries(i).forEach(([b,w])=>{w?.addEventListener("change",()=>{l.setMirror(b,w.checked),Z(),M()})});const u=document.getElementById("problem-text"),o=document.getElementById("explanation-text"),a=document.getElementById("correct-feedback"),d=document.getElementById("incorrect-feedback");u?.addEventListener("input",()=>{l.setProblemText(u.value)}),o?.addEventListener("input",()=>{l.setExplanationText(o.value)}),a?.addEventListener("input",()=>{l.setCorrectFeedback(a.value)}),d?.addEventListener("input",()=>{l.setIncorrectFeedback(d.value)}),document.getElementById("add-touch-area-btn")?.addEventListener("click",()=>{l.addTouchArea(),M(),_()});const S=document.getElementById("submit-answer-btn"),x=document.getElementById("reset-btn"),B=document.getElementById("why-btn");S?.addEventListener("click",()=>{const b=l.submitAnswer();st(b)}),x?.addEventListener("click",()=>{l.resetPuzzle(),l.clearSubmissionResult(),D()}),B?.addEventListener("click",()=>{const b=document.getElementById("explanation-container"),w=document.getElementById("explanation-display");b&&w&&(w.textContent=l.getContent().explanationText,b.style.display="block")}),D()}function Y(){const c=document.getElementById("edit-mode-btn"),t=document.getElementById("play-mode-btn"),e=document.getElementById("edit-controls"),r=document.getElementById("play-controls");if(l.getMode()==="edit")c?.classList.add("active"),t?.classList.remove("active"),e&&(e.style.display="block"),r&&(r.style.display="none");else{c?.classList.remove("active"),t?.classList.add("active"),e&&(e.style.display="none"),r&&(r.style.display="block");const a=document.getElementById("problem-display");a&&(a.textContent=l.getContent().problemText)}const i=document.getElementById("feedback-container"),u=document.getElementById("explanation-container"),o=document.getElementById("submit-answer-btn");i&&(i.style.display="none"),u&&(u.style.display="none"),o&&(o.style.display="block"),l.clearSubmissionResult()}function Z(){const c=document.querySelector(".mirror-center");if(!c)return;const t=l.getMirrors();c.classList.toggle("mirror-top-active",t.top),c.classList.toggle("mirror-right-active",t.right),c.classList.toggle("mirror-bottom-active",t.bottom),c.classList.toggle("mirror-left-active",t.left)}function _(){const c=document.getElementById("configuration-warning"),t=document.getElementById("warning-message");if(!c||!t)return;const e=l.validateConfiguration();e.message?(t.textContent=e.message,c.style.display="flex"):c.style.display="none"}function st(c){const t=document.getElementById("feedback-container"),e=document.getElementById("feedback-message"),r=document.getElementById("submit-answer-btn");!t||!e||(e.textContent=c.message,e.className=c.isCorrect?"correct":"incorrect",t.style.display="block",r&&(r.style.display="none"),l.storeSubmissionResult(c),M())}function M(){const c=document.getElementById("canvas");if(!c)return;const t=document.getElementById("room-group")||V(c,"room-group"),e=document.getElementById("objects-group")||V(c,"objects-group"),r=document.getElementById("virtual-objects")||c.querySelector("#virtual-objects"),s=document.getElementById("virtual-rooms")||c.querySelector("#virtual-rooms"),i=document.getElementById("touch-areas-group")||V(c,"touch-areas-group"),u=document.getElementById("ray-paths-group")||V(c,"ray-paths-group");t.innerHTML="",e.innerHTML="",r&&(r.innerHTML=""),s&&(s.innerHTML=""),i.innerHTML="",u.innerHTML="";const o=200,d=(800-o)/2,C=(n,v)=>({x:n+d,y:v+d}),S=document.createElementNS("http://www.w3.org/2000/svg","rect");S.setAttribute("x","0"),S.setAttribute("y","0"),S.setAttribute("width","800"),S.setAttribute("height","800"),S.setAttribute("fill","#e0e0e0"),t.appendChild(S);const x=document.createElementNS("http://www.w3.org/2000/svg","rect");x.setAttribute("x",String(d)),x.setAttribute("y",String(d)),x.setAttribute("width",String(o)),x.setAttribute("height",String(o)),x.setAttribute("fill","#ffffff"),x.setAttribute("stroke","#333"),x.setAttribute("stroke-width","2"),t.appendChild(x);const B=l.getMirrors(),b="stroke: #4a90e2; stroke-width: 3; stroke-linecap: round;";if(B.top){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",String(d)),n.setAttribute("y1",String(d)),n.setAttribute("x2",String(d+o)),n.setAttribute("y2",String(d)),n.setAttribute("style",b),t.appendChild(n)}if(B.right){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",String(d+o)),n.setAttribute("y1",String(d)),n.setAttribute("x2",String(d+o)),n.setAttribute("y2",String(d+o)),n.setAttribute("style",b),t.appendChild(n)}if(B.bottom){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",String(d)),n.setAttribute("y1",String(d+o)),n.setAttribute("x2",String(d+o)),n.setAttribute("y2",String(d+o)),n.setAttribute("style",b),t.appendChild(n)}if(B.left){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",String(d)),n.setAttribute("y1",String(d)),n.setAttribute("x2",String(d)),n.setAttribute("y2",String(d+o)),n.setAttribute("style",b),t.appendChild(n)}const w=l.getObjects(),m=C(w.triangle.x,w.triangle.y),h=document.createElementNS("http://www.w3.org/2000/svg","polygon"),g=10,y=`${m.x},${m.y-g} ${m.x-g},${m.y+g} ${m.x+g},${m.y+g}`;h.setAttribute("points",y),h.setAttribute("fill","#ff6b6b"),h.setAttribute("stroke","#d63031"),h.setAttribute("stroke-width","2"),h.setAttribute("class","draggable-object"),h.setAttribute("data-object","triangle"),h.setAttribute("cursor",l.getMode()==="edit"?"move":"default"),e.appendChild(h);const k=C(w.viewer.x,w.viewer.y),p=document.createElementNS("http://www.w3.org/2000/svg","ellipse");p.setAttribute("cx",String(k.x)),p.setAttribute("cy",String(k.y)),p.setAttribute("rx","12"),p.setAttribute("ry","8"),p.setAttribute("fill","#333"),p.setAttribute("stroke","#000"),p.setAttribute("stroke-width","2"),p.setAttribute("class","draggable-object"),p.setAttribute("data-object","viewer"),p.setAttribute("cursor",l.getMode()==="edit"?"move":"default"),e.appendChild(p);const A=document.createElementNS("http://www.w3.org/2000/svg","circle");A.setAttribute("cx",String(k.x)),A.setAttribute("cy",String(k.y)),A.setAttribute("r","4"),A.setAttribute("fill","#fff"),A.setAttribute("pointer-events","none"),e.appendChild(A);const L=l.getVirtualObjects();L.virtualRooms.forEach(n=>{if(n.depth>0){const v=C(n.position.x,n.position.y),f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("x",String(v.x)),f.setAttribute("y",String(v.y)),f.setAttribute("width",String(o)),f.setAttribute("height",String(o)),f.setAttribute("fill","none"),f.setAttribute("stroke","#999"),f.setAttribute("stroke-width","1"),f.setAttribute("stroke-dasharray","3,3"),f.setAttribute("opacity",String(n.opacity)),s&&s.appendChild(f)}}),L.virtualObjects.forEach(n=>{const v=C(n.position.x,n.position.y);if(n.sourceType==="triangle"){const f=document.createElementNS("http://www.w3.org/2000/svg","polygon"),N=`${v.x},${v.y-g} ${v.x-g},${v.y+g} ${v.x+g},${v.y+g}`;f.setAttribute("points",N),f.setAttribute("fill","#ff6b6b"),f.setAttribute("stroke","#d63031"),f.setAttribute("stroke-width","1"),f.setAttribute("opacity",String(n.opacity)),f.setAttribute("stroke-dasharray","2,2"),r&&r.appendChild(f)}});const W=l.getAllTouchAreas(),J=l.getSelectedTouchAreas(),X=l.getMode(),H=l.getSubmissionResult();W.forEach(n=>{const v=n.position.x,f=n.position.y,N=60,G=X==="play"&&H;let T,j,R,$="1",z=!1,P="",F="";if(X==="edit")T=n.isCorrect?"rgba(76, 175, 80, 0.2)":"rgba(244, 67, 54, 0.2)",j=n.isCorrect?"#4caf50":"#f44336",R="2",z=!0,P=n.isCorrect?"#4caf50":"#f44336",F=n.isCorrect?"âœ“":"âœ—";else if(G)J.includes(n.id)?H.isCorrect?(T="rgba(76, 175, 80, 0.3)",j="#4caf50",R="3",z=!0,P="#4caf50",F="âœ“"):H.selectedCorrect.includes(n.id)?(T="rgba(158, 158, 158, 0.3)",j="#757575",R="3",z=!0,P="#757575",F="âœ“"):H.selectedIncorrect.includes(n.id)?(T="rgba(255, 193, 7, 0.3)",j="#ff9800",R="3",z=!0,P="#ff9800",F="âœ—"):($="0",T="transparent",j="transparent",R="0"):($="0",T="transparent",j="transparent",R="0");else{const I=J.includes(n.id);T=I?"rgba(33, 150, 243, 0.3)":"rgba(158, 158, 158, 0.05)",j=I?"#2196f3":"#999999",R=I?"3":"2"}const E=document.createElementNS("http://www.w3.org/2000/svg","rect");if(E.setAttribute("x",String(v-N/2)),E.setAttribute("y",String(f-N/2)),E.setAttribute("width",String(N)),E.setAttribute("height",String(N)),E.setAttribute("rx","8"),E.setAttribute("ry","8"),E.setAttribute("opacity",$),X==="edit"?(E.setAttribute("style",`fill: ${T}; stroke: ${j}; stroke-width: ${R}; cursor: move; opacity: ${$}`),E.setAttribute("title","Click to toggle correct/incorrect, Drag to move, Right-click to delete")):G?E.setAttribute("style",`fill: ${T}; stroke: ${j}; stroke-width: ${R}; cursor: default; opacity: ${$}; pointer-events: none;`):E.setAttribute("style",`fill: ${T}; stroke: ${j}; stroke-width: ${R}; cursor: pointer; opacity: ${$}`),E.setAttribute("class","touch-area"),E.setAttribute("data-id",n.id),i.appendChild(E),z&&$!=="0"){const I=document.createElementNS("http://www.w3.org/2000/svg","circle"),U=v+N/2-10,q=f-N/2+10;I.setAttribute("cx",String(U)),I.setAttribute("cy",String(q)),I.setAttribute("r","10"),I.setAttribute("fill",P),I.setAttribute("pointer-events","none"),i.appendChild(I);const O=document.createElementNS("http://www.w3.org/2000/svg","text");O.setAttribute("x",String(U)),O.setAttribute("y",String(q+4)),O.setAttribute("text-anchor","middle"),O.setAttribute("font-size","14"),O.setAttribute("font-weight","bold"),O.setAttribute("fill","white"),O.setAttribute("pointer-events","none"),O.textContent=F,i.appendChild(O)}})}function V(c,t){const e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.setAttribute("id",t),c.appendChild(e),e}function D(){Y(),Z(),_(),M();const c=l.getContent(),t=document.getElementById("problem-text"),e=document.getElementById("explanation-text"),r=document.getElementById("correct-feedback"),s=document.getElementById("incorrect-feedback");t&&(t.value=c.problemText),e&&(e.value=c.explanationText),r&&(r.value=c.correctFeedback),s&&(s.value=c.incorrectFeedback);const i=l.getMirrors(),u=document.getElementById("mirror-top"),o=document.getElementById("mirror-right"),a=document.getElementById("mirror-bottom"),d=document.getElementById("mirror-left");u&&(u.checked=i.top),o&&(o.checked=i.right),a&&(a.checked=i.bottom),d&&(d.checked=i.left)}function rt(c,t){const e=new Blob([c],{type:"application/json"}),r=URL.createObjectURL(e),s=document.createElement("a");s.href=r,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}function Q(){const c=document.getElementById("canvas");if(!c)return;let t=!1,e=null,r=null,s={x:0,y:0},i={x:0,y:0},u=!1;const o=200,a=800,d=(a-o)/2,C=10,S=12,x=8;function B(m,h){return{x:m-d,y:h-d}}function b(m){const h=c.getBoundingClientRect();return{x:m.clientX-h.left,y:m.clientY-h.top}}function w(m,h,g){let y,k,p,A;return g==="triangle"?(y=C,k=o-C,p=C,A=o-C):(y=S,k=o-S,p=x,A=o-x),{x:Math.max(y,Math.min(k,m)),y:Math.max(p,Math.min(A,h))}}c.addEventListener("mousedown",m=>{const h=m.target,g=l.getMode();if(g==="edit"){const y=h.getAttribute("data-object"),k=h.getAttribute("data-id");if(y==="triangle"||y==="viewer"){t=!0,e=y;const p=b(m),A=l.getObjects(),L=e==="triangle"?A.triangle:A.viewer;s={x:p.x-(L.x+d),y:p.y-(L.y+d)},m.preventDefault()}else if(k){const p=b(m);i={x:p.x,y:p.y},u=!1,r=k;const L=l.getAllTouchAreas().find(W=>W.id===k);L&&(s={x:p.x-L.position.x,y:p.y-L.position.y}),m.preventDefault()}}else if(g==="play"){const y=h.getAttribute("data-id");y&&(l.getAllTouchAreas().find(A=>A.id===y)&&(l.getSelectedTouchAreas().includes(y)?l.deselectTouchArea(y):l.selectTouchArea(y),M()),m.preventDefault())}}),c.addEventListener("mousemove",m=>{const h=b(m);if(r&&!t&&Math.sqrt(Math.pow(h.x-i.x,2)+Math.pow(h.y-i.y,2))>5&&(t=!0,u=!0),!!t){if(e){const g=B(h.x-s.x,h.y-s.y),y=w(g.x,g.y,e);l.moveObject(e,y),M()}else if(r){const g={x:h.x-s.x,y:h.y-s.y},y={x:Math.max(30,Math.min(a-30,g.x)),y:Math.max(30,Math.min(a-30,g.y))};l.moveTouchArea(r,y),M()}m.preventDefault()}}),c.addEventListener("mouseup",()=>{if(r&&!u&&l.getMode()==="edit"){const h=l.getAllTouchAreas().find(g=>g.id===r);h&&(l.setTouchAreaCorrect(r,!h.isCorrect),M())}t=!1,e=null,r=null,u=!1}),c.addEventListener("mouseleave",()=>{t=!1,e=null,r=null,u=!1}),c.addEventListener("contextmenu",m=>{if(l.getMode()!=="edit")return;const g=m.target.getAttribute("data-id");g&&(l.deleteTouchArea(g),M(),m.preventDefault())})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{K(),Q(),D()}):(K(),Q(),D());
