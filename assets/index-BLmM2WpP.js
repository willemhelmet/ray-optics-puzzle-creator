(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class tt{roomWidth=200;roomHeight=200;calculateVirtualObjects(t,e,o){const s=[],r=[],u={position:{x:0,y:0}};return e[0]&&r.push({position:{x:0,y:-this.roomHeight},mirrors:e,depth:1,opacity:.7}),e[1]&&r.push({position:{x:this.roomWidth,y:0},mirrors:e,depth:1,opacity:.7}),e[2]&&r.push({position:{x:0,y:this.roomHeight},mirrors:e,depth:1,opacity:.7}),e[3]&&r.push({position:{x:-this.roomWidth,y:0},mirrors:e,depth:1,opacity:.7}),r.forEach(i=>{if(i.depth===0)return;let a;i.position.y<0?a="top":i.position.x>0?a="right":i.position.y>0?a="bottom":a="left";const d=this.getMirrorPosition(a,u.position);s.push(this.reflectAcrossMirror(t.triangle.position,"triangle",a,i.depth,d),this.reflectAcrossMirror(t.viewer.position,"viewer",a,i.depth,d))}),{virtualObjects:s,virtualRooms:r}}getMirrorPosition(t,e){switch(t){case"top":return e.y;case"bottom":return e.y+this.roomHeight;case"left":return e.x;case"right":return e.x+this.roomWidth}}reflectAcrossMirror(t,e,o,s,r,u){const i={...t};let a=u?.flippedX||!1,d=u?.flippedY||!1;switch(o){case"top":const C=r??0;i.y=2*C-t.y,d=!d;break;case"right":const S=r??this.roomWidth;i.x=2*S-t.x,a=!a;break;case"bottom":const x=r??this.roomHeight;i.y=2*x-t.y,d=!d;break;case"left":const M=r??0;i.x=2*M-t.x,a=!a;break}return{id:`${e}-d${s}-${o}`,sourceType:e,position:i,flippedX:a,flippedY:d,depth:s,opacity:1-s*.3}}calculateRayPath(t,e,o){const s=[];if(s.push(t.position),t.depth===1){const r=t.id.split("-")[2],u=this.getRayMirrorIntersection(t.position,e,r);u&&s.push(u)}else t.depth>1;return s.push(e),s}getRayMirrorIntersection(t,e,o){switch(o){case"top":const s=-t.y/(e.y-t.y);if(s>=0&&s<=1){const a=t.x+s*(e.x-t.x);if(a>=0&&a<=this.roomWidth)return{x:a,y:0}}break;case"right":const r=(this.roomWidth-t.x)/(e.x-t.x);if(r>=0&&r<=1){const a=t.y+r*(e.y-t.y);if(a>=0&&a<=this.roomHeight)return{x:this.roomWidth,y:a}}break;case"bottom":const u=(this.roomHeight-t.y)/(e.y-t.y);if(u>=0&&u<=1){const a=t.x+u*(e.x-t.x);if(a>=0&&a<=this.roomWidth)return{x:a,y:this.roomHeight}}break;case"left":const i=-t.x/(e.x-t.x);if(i>=0&&i<=1){const a=t.y+i*(e.y-t.y);if(a>=0&&a<=this.roomHeight)return{x:0,y:a}}break}return null}}class et{state;reflectionEngine;selectedTouchAreas=new Set;submissionResult=null;constructor(){this.state={mode:"edit",room:{width:200,height:200,mirrors:[!1,!1,!1,!1]},objects:{triangle:{position:{x:100,y:75}},viewer:{position:{x:100,y:175}}},touchAreas:[],content:{problemText:"",explanationText:"",correctFeedback:"",incorrectFeedback:""},selectedVirtualObjectForRay:null,maxReflectionDepth:3},this.reflectionEngine=new tt}setMode(t){this.state.mode=t,this.selectedTouchAreas.clear(),this.submissionResult=null}getMode(){return this.state.mode}getObjects(){return{triangle:{...this.state.objects.triangle.position},viewer:{...this.state.objects.viewer.position}}}moveObject(t,e){if(this.state.mode!=="edit")return;const o=20,s={x:Math.max(o,Math.min(this.state.room.width-o,e.x)),y:Math.max(o,Math.min(this.state.room.height-o,e.y))};this.state.objects[t].position=s}getObjectPosition(t){return{...this.state.objects[t].position}}addTouchArea(t){if(this.state.mode!=="edit")return"";const e=`touch-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,o={id:e,position:t||{x:400,y:400},isCorrect:!0,radius:30};return this.state.touchAreas.push(o),e}moveTouchArea(t,e){if(this.state.mode!=="edit")return;const o=this.state.touchAreas.find(s=>s.id===t);o&&(o.position=e)}setTouchAreaCorrect(t,e){if(this.state.mode!=="edit")return;const o=this.state.touchAreas.find(s=>s.id===t);o&&(o.isCorrect=e)}deleteTouchArea(t){this.state.mode==="edit"&&(this.state.touchAreas=this.state.touchAreas.filter(e=>e.id!==t))}getAllTouchAreas(){return[...this.state.touchAreas]}setMirror(t,e){if(this.state.mode!=="edit")return;const o=this.getMirrorIndex(t);this.state.room.mirrors[o]=e}toggleMirror(t){if(this.state.mode!=="edit")return;const e=this.getMirrorIndex(t);this.state.room.mirrors[e]=!this.state.room.mirrors[e]}getMirrors(){return{top:this.state.room.mirrors[0],right:this.state.room.mirrors[1],bottom:this.state.room.mirrors[2],left:this.state.room.mirrors[3]}}getMirrorIndex(t){switch(t){case"top":return 0;case"right":return 1;case"bottom":return 2;case"left":return 3}}setProblemText(t){this.state.mode==="edit"&&(this.state.content.problemText=t)}setExplanationText(t){this.state.mode==="edit"&&(this.state.content.explanationText=t)}setCorrectFeedback(t){this.state.mode==="edit"&&(this.state.content.correctFeedback=t)}setIncorrectFeedback(t){this.state.mode==="edit"&&(this.state.content.incorrectFeedback=t)}getContent(){return{...this.state.content}}selectVirtualObjectForRay(t){this.state.mode==="edit"&&(this.state.selectedVirtualObjectForRay=t)}getSelectedVirtualObject(){return this.state.selectedVirtualObjectForRay}getVirtualObjects(){const t=this.reflectionEngine.calculateVirtualObjects(this.state.objects,this.state.room.mirrors,this.state.maxReflectionDepth);if(this.state.selectedVirtualObjectForRay){const e=t.virtualObjects.find(o=>o.id===this.state.selectedVirtualObjectForRay);e&&(e.rayPath=this.reflectionEngine.calculateRayPath(e,this.state.objects.viewer.position,this.state.room.mirrors))}return t}getVirtualRooms(){return this.reflectionEngine.calculateVirtualObjects(this.state.objects,this.state.room.mirrors,this.state.maxReflectionDepth).virtualRooms}selectTouchArea(t){this.state.mode==="play"&&this.selectedTouchAreas.add(t)}deselectTouchArea(t){this.state.mode==="play"&&this.selectedTouchAreas.delete(t)}getSelectedTouchAreas(){return Array.from(this.selectedTouchAreas)}submitAnswer(){if(this.state.mode!=="play")return{isCorrect:!1,selectedCorrect:[],selectedIncorrect:[],missedCorrect:[],message:"Can only submit in play mode"};const t=[],e=[],o=[];for(const i of this.selectedTouchAreas){const a=this.state.touchAreas.find(d=>d.id===i);a&&(a.isCorrect?t.push(i):e.push(i))}for(const i of this.state.touchAreas)i.isCorrect&&!this.selectedTouchAreas.has(i.id)&&o.push(i.id);const s=e.length===0&&o.length===0,r=s?this.state.content.correctFeedback||"Correct!":this.state.content.incorrectFeedback||"Try again!",u={isCorrect:s,selectedCorrect:t,selectedIncorrect:e,missedCorrect:o,message:r};return this.submissionResult=u,u}resetPuzzle(){this.selectedTouchAreas.clear(),this.submissionResult=null}storeSubmissionResult(t){this.submissionResult=t}getSubmissionResult(){return this.submissionResult}clearSubmissionResult(){this.submissionResult=null}exportJSON(){return JSON.stringify(this.state,null,2)}importJSON(t){try{const e=JSON.parse(t);e.mode&&e.room&&e.objects&&e.touchAreas&&e.content&&(this.state=e,this.selectedTouchAreas.clear())}catch(e){console.error("Failed to import JSON:",e)}}validateConfiguration(){const t=[];this.state.touchAreas.length===0?t.push({type:"error",message:"No touch areas defined - puzzle cannot be played"}):this.state.touchAreas.some(r=>r.isCorrect)||t.push({type:"error",message:"No correct touch areas defined - puzzle has no solution"}),this.state.touchAreas.length>=5&&t.push({type:"warning",message:"5+ touch areas - puzzle is getting too complex"});const e=[];return this.state.content.problemText||e.push("Problem"),this.state.content.explanationText||e.push("Explanation"),this.state.content.correctFeedback||e.push("Correct Feedback"),this.state.content.incorrectFeedback||e.push("Incorrect Feedback"),e.length>0&&t.push({type:"info",message:`${e.length} empty text field${e.length>1?"s":""}: ${e.join(", ")}`}),{isValid:!t.some(s=>s.type==="error"),warnings:t}}isPointInRoom(t){return t.x>=0&&t.x<=this.state.room.width&&t.y>=0&&t.y<=this.state.room.height}transformToCanvas(t){return{x:t.x+300,y:t.y+300}}transformToRoom(t){return{x:t.x-300,y:t.y-300}}getState(){return this.state}}const l=new et;function Q(){const c=document.getElementById("edit-mode-btn"),t=document.getElementById("play-mode-btn");c?.addEventListener("click",()=>{l.setMode("edit"),J(),I()}),t?.addEventListener("click",()=>{l.setMode("play"),J(),I()});const e=document.getElementById("export-btn"),o=document.getElementById("import-btn"),s=document.getElementById("import-input");e?.addEventListener("click",()=>{const b=l.exportJSON();ot(b,"puzzle.json")}),o?.addEventListener("click",()=>{s?.click()}),s?.addEventListener("change",b=>{const w=b.target.files?.[0];if(w){const h=new FileReader;h.onload=m=>{const g=m.target?.result;l.importJSON(g),D()},h.readAsText(w)}});const r={top:document.getElementById("mirror-top"),right:document.getElementById("mirror-right"),bottom:document.getElementById("mirror-bottom"),left:document.getElementById("mirror-left")};Object.entries(r).forEach(([b,w])=>{w?.addEventListener("change",()=>{l.setMirror(b,w.checked),_(),I()})});const u=document.getElementById("problem-text"),i=document.getElementById("explanation-text"),a=document.getElementById("correct-feedback"),d=document.getElementById("incorrect-feedback");u?.addEventListener("input",()=>{l.setProblemText(u.value),N()}),i?.addEventListener("input",()=>{l.setExplanationText(i.value),N()}),a?.addEventListener("input",()=>{l.setCorrectFeedback(a.value),N()}),d?.addEventListener("input",()=>{l.setIncorrectFeedback(d.value),N()}),document.getElementById("add-touch-area-btn")?.addEventListener("click",()=>{l.addTouchArea(),I(),N()});const S=document.getElementById("submit-answer-btn"),x=document.getElementById("reset-btn"),M=document.getElementById("why-btn");S?.addEventListener("click",()=>{const b=l.submitAnswer();st(b)}),x?.addEventListener("click",()=>{l.resetPuzzle(),l.clearSubmissionResult(),D()}),M?.addEventListener("click",()=>{const b=document.getElementById("explanation-container"),w=document.getElementById("explanation-display");if(b&&w){const h=l.getContent().explanationText;w.textContent=h||"Light bounces off mirrors to create virtual images. The position of these reflections follows the laws of physics - the angle of incidence equals the angle of reflection.",b.style.display="block"}}),D()}function J(){const c=document.getElementById("edit-mode-btn"),t=document.getElementById("play-mode-btn"),e=document.getElementById("edit-controls"),o=document.getElementById("play-controls");if(l.getMode()==="edit")c?.classList.add("active"),t?.classList.remove("active"),e&&(e.style.display="block"),o&&(o.style.display="none");else{c?.classList.remove("active"),t?.classList.add("active"),e&&(e.style.display="none"),o&&(o.style.display="block");const a=document.getElementById("problem-display");if(a){const d=l.getContent().problemText;a.textContent=d||"Click where you see reflections of the triangle"}}const r=document.getElementById("feedback-container"),u=document.getElementById("explanation-container"),i=document.getElementById("submit-answer-btn");r&&(r.style.display="none"),u&&(u.style.display="none"),i&&(i.style.display="block"),l.clearSubmissionResult()}function _(){const c=document.querySelector(".mirror-center");if(!c)return;const t=l.getMirrors();c.classList.toggle("mirror-top-active",t.top),c.classList.toggle("mirror-right-active",t.right),c.classList.toggle("mirror-bottom-active",t.bottom),c.classList.toggle("mirror-left-active",t.left)}function N(){const c=document.getElementById("configuration-warnings");if(!c)return;const t=l.validateConfiguration();c.innerHTML="",t.warnings.forEach(e=>{const o=document.createElement("div");o.className=`warning-box ${e.type}`;const s=document.createElement("span");s.className="warning-icon",e.type==="error"?s.textContent="❌":e.type==="warning"?s.textContent="⚠️":s.textContent="ℹ️";const r=document.createElement("span");r.className="warning-message",r.textContent=e.message,o.appendChild(s),o.appendChild(r),c.appendChild(o)})}function st(c){const t=document.getElementById("feedback-container"),e=document.getElementById("feedback-message"),o=document.getElementById("submit-answer-btn");!t||!e||(e.textContent=c.message,e.className=c.isCorrect?"correct":"incorrect",t.style.display="block",o&&(o.style.display="none"),l.storeSubmissionResult(c),I())}function I(){const c=document.getElementById("canvas");if(!c)return;const t=document.getElementById("room-group")||W(c,"room-group"),e=document.getElementById("objects-group")||W(c,"objects-group"),o=document.getElementById("virtual-objects")||c.querySelector("#virtual-objects"),s=document.getElementById("virtual-rooms")||c.querySelector("#virtual-rooms"),r=document.getElementById("touch-areas-group")||W(c,"touch-areas-group"),u=document.getElementById("ray-paths-group")||W(c,"ray-paths-group");t.innerHTML="",e.innerHTML="",o&&(o.innerHTML=""),s&&(s.innerHTML=""),r.innerHTML="",u.innerHTML="";const i=200,d=(800-i)/2,C=(n,v)=>({x:n+d,y:v+d}),S=document.createElementNS("http://www.w3.org/2000/svg","rect");S.setAttribute("x","0"),S.setAttribute("y","0"),S.setAttribute("width","800"),S.setAttribute("height","800"),S.setAttribute("fill","#e0e0e0"),t.appendChild(S);const x=document.createElementNS("http://www.w3.org/2000/svg","rect");x.setAttribute("x",String(d)),x.setAttribute("y",String(d)),x.setAttribute("width",String(i)),x.setAttribute("height",String(i)),x.setAttribute("fill","#ffffff"),x.setAttribute("stroke","#333"),x.setAttribute("stroke-width","2"),t.appendChild(x);const M=l.getMirrors(),b="stroke: #4a90e2; stroke-width: 3; stroke-linecap: round;";if(M.top){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",String(d)),n.setAttribute("y1",String(d)),n.setAttribute("x2",String(d+i)),n.setAttribute("y2",String(d)),n.setAttribute("style",b),t.appendChild(n)}if(M.right){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",String(d+i)),n.setAttribute("y1",String(d)),n.setAttribute("x2",String(d+i)),n.setAttribute("y2",String(d+i)),n.setAttribute("style",b),t.appendChild(n)}if(M.bottom){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",String(d)),n.setAttribute("y1",String(d+i)),n.setAttribute("x2",String(d+i)),n.setAttribute("y2",String(d+i)),n.setAttribute("style",b),t.appendChild(n)}if(M.left){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",String(d)),n.setAttribute("y1",String(d)),n.setAttribute("x2",String(d)),n.setAttribute("y2",String(d+i)),n.setAttribute("style",b),t.appendChild(n)}const w=l.getObjects(),h=C(w.triangle.x,w.triangle.y),m=document.createElementNS("http://www.w3.org/2000/svg","polygon"),g=10,y=`${h.x},${h.y-g} ${h.x-g},${h.y+g} ${h.x+g},${h.y+g}`;m.setAttribute("points",y),m.setAttribute("fill","#ff6b6b"),m.setAttribute("stroke","#d63031"),m.setAttribute("stroke-width","2"),m.setAttribute("class","draggable-object"),m.setAttribute("data-object","triangle"),m.setAttribute("cursor",l.getMode()==="edit"?"move":"default"),e.appendChild(m);const k=C(w.viewer.x,w.viewer.y),p=document.createElementNS("http://www.w3.org/2000/svg","ellipse");p.setAttribute("cx",String(k.x)),p.setAttribute("cy",String(k.y)),p.setAttribute("rx","12"),p.setAttribute("ry","8"),p.setAttribute("fill","#333"),p.setAttribute("stroke","#000"),p.setAttribute("stroke-width","2"),p.setAttribute("class","draggable-object"),p.setAttribute("data-object","viewer"),p.setAttribute("cursor",l.getMode()==="edit"?"move":"default"),e.appendChild(p);const A=document.createElementNS("http://www.w3.org/2000/svg","circle");A.setAttribute("cx",String(k.x)),A.setAttribute("cy",String(k.y)),A.setAttribute("r","4"),A.setAttribute("fill","#fff"),A.setAttribute("pointer-events","none"),e.appendChild(A);const R=l.getVirtualObjects();R.virtualRooms.forEach(n=>{if(n.depth>0){const v=C(n.position.x,n.position.y),f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("x",String(v.x)),f.setAttribute("y",String(v.y)),f.setAttribute("width",String(i)),f.setAttribute("height",String(i)),f.setAttribute("fill","none"),f.setAttribute("stroke","#999"),f.setAttribute("stroke-width","1"),f.setAttribute("stroke-dasharray","3,3"),f.setAttribute("opacity",String(n.opacity)),s&&s.appendChild(f)}}),R.virtualObjects.forEach(n=>{const v=C(n.position.x,n.position.y);if(n.sourceType==="triangle"){const f=document.createElementNS("http://www.w3.org/2000/svg","polygon"),$=`${v.x},${v.y-g} ${v.x-g},${v.y+g} ${v.x+g},${v.y+g}`;f.setAttribute("points",$),f.setAttribute("fill","#ff6b6b"),f.setAttribute("stroke","#d63031"),f.setAttribute("stroke-width","1"),f.setAttribute("opacity",String(n.opacity)),f.setAttribute("stroke-dasharray","2,2"),o&&o.appendChild(f)}});const X=l.getAllTouchAreas(),G=l.getSelectedTouchAreas(),Y=l.getMode(),V=l.getSubmissionResult();X.forEach(n=>{const v=n.position.x,f=n.position.y,$=60,U=Y==="play"&&V;let B,j,L,F="1",z=!1,P="",H="";if(Y==="edit")B=n.isCorrect?"rgba(76, 175, 80, 0.2)":"rgba(244, 67, 54, 0.2)",j=n.isCorrect?"#4caf50":"#f44336",L="2",z=!0,P=n.isCorrect?"#4caf50":"#f44336",H=n.isCorrect?"✓":"✗";else if(U)G.includes(n.id)?V.isCorrect?(B="rgba(76, 175, 80, 0.3)",j="#4caf50",L="3",z=!0,P="#4caf50",H="✓"):V.selectedCorrect.includes(n.id)?(B="rgba(158, 158, 158, 0.3)",j="#757575",L="3",z=!0,P="#757575",H="✓"):V.selectedIncorrect.includes(n.id)?(B="rgba(255, 193, 7, 0.3)",j="#ff9800",L="3",z=!0,P="#ff9800",H="✗"):(F="0",B="transparent",j="transparent",L="0"):(F="0",B="transparent",j="transparent",L="0");else{const T=G.includes(n.id);B=T?"rgba(33, 150, 243, 0.3)":"rgba(158, 158, 158, 0.05)",j=T?"#2196f3":"#999999",L=T?"3":"2"}const E=document.createElementNS("http://www.w3.org/2000/svg","rect");if(E.setAttribute("x",String(v-$/2)),E.setAttribute("y",String(f-$/2)),E.setAttribute("width",String($)),E.setAttribute("height",String($)),E.setAttribute("rx","8"),E.setAttribute("ry","8"),E.setAttribute("opacity",F),Y==="edit"?(E.setAttribute("style",`fill: ${B}; stroke: ${j}; stroke-width: ${L}; cursor: move; opacity: ${F}`),E.setAttribute("title","Click to toggle correct/incorrect, Drag to move, Right-click to delete")):U?E.setAttribute("style",`fill: ${B}; stroke: ${j}; stroke-width: ${L}; cursor: default; opacity: ${F}; pointer-events: none;`):E.setAttribute("style",`fill: ${B}; stroke: ${j}; stroke-width: ${L}; cursor: pointer; opacity: ${F}`),E.setAttribute("class","touch-area"),E.setAttribute("data-id",n.id),r.appendChild(E),z&&F!=="0"){const T=document.createElementNS("http://www.w3.org/2000/svg","circle"),q=v+$/2-10,K=f-$/2+10;T.setAttribute("cx",String(q)),T.setAttribute("cy",String(K)),T.setAttribute("r","10"),T.setAttribute("fill",P),T.setAttribute("pointer-events","none"),r.appendChild(T);const O=document.createElementNS("http://www.w3.org/2000/svg","text");O.setAttribute("x",String(q)),O.setAttribute("y",String(K+4)),O.setAttribute("text-anchor","middle"),O.setAttribute("font-size","14"),O.setAttribute("font-weight","bold"),O.setAttribute("fill","white"),O.setAttribute("pointer-events","none"),O.textContent=H,r.appendChild(O)}})}function W(c,t){const e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.setAttribute("id",t),c.appendChild(e),e}function D(){J(),_(),N(),I();const c=l.getContent(),t=document.getElementById("problem-text"),e=document.getElementById("explanation-text"),o=document.getElementById("correct-feedback"),s=document.getElementById("incorrect-feedback");t&&(t.value=c.problemText),e&&(e.value=c.explanationText),o&&(o.value=c.correctFeedback),s&&(s.value=c.incorrectFeedback);const r=l.getMirrors(),u=document.getElementById("mirror-top"),i=document.getElementById("mirror-right"),a=document.getElementById("mirror-bottom"),d=document.getElementById("mirror-left");u&&(u.checked=r.top),i&&(i.checked=r.right),a&&(a.checked=r.bottom),d&&(d.checked=r.left)}function ot(c,t){const e=new Blob([c],{type:"application/json"}),o=URL.createObjectURL(e),s=document.createElement("a");s.href=o,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}function Z(){const c=document.getElementById("canvas");if(!c)return;let t=!1,e=null,o=null,s={x:0,y:0},r={x:0,y:0},u=!1;const i=200,a=800,d=(a-i)/2,C=10,S=12,x=8;function M(h,m){return{x:h-d,y:m-d}}function b(h){const m=c.getBoundingClientRect();return{x:h.clientX-m.left,y:h.clientY-m.top}}function w(h,m,g){let y,k,p,A;return g==="triangle"?(y=C,k=i-C,p=C,A=i-C):(y=S,k=i-S,p=x,A=i-x),{x:Math.max(y,Math.min(k,h)),y:Math.max(p,Math.min(A,m))}}c.addEventListener("mousedown",h=>{const m=h.target,g=l.getMode();if(g==="edit"){const y=m.getAttribute("data-object"),k=m.getAttribute("data-id");if(y==="triangle"||y==="viewer"){t=!0,e=y;const p=b(h),A=l.getObjects(),R=e==="triangle"?A.triangle:A.viewer;s={x:p.x-(R.x+d),y:p.y-(R.y+d)},h.preventDefault()}else if(k){const p=b(h);r={x:p.x,y:p.y},u=!1,o=k;const R=l.getAllTouchAreas().find(X=>X.id===k);R&&(s={x:p.x-R.position.x,y:p.y-R.position.y}),h.preventDefault()}}else if(g==="play"){const y=m.getAttribute("data-id");y&&(l.getAllTouchAreas().find(A=>A.id===y)&&(l.getSelectedTouchAreas().includes(y)?l.deselectTouchArea(y):l.selectTouchArea(y),I()),h.preventDefault())}}),c.addEventListener("mousemove",h=>{const m=b(h);if(o&&!t&&Math.sqrt(Math.pow(m.x-r.x,2)+Math.pow(m.y-r.y,2))>5&&(t=!0,u=!0),!!t){if(e){const g=M(m.x-s.x,m.y-s.y),y=w(g.x,g.y,e);l.moveObject(e,y),I()}else if(o){const g={x:m.x-s.x,y:m.y-s.y},y={x:Math.max(30,Math.min(a-30,g.x)),y:Math.max(30,Math.min(a-30,g.y))};l.moveTouchArea(o,y),I()}h.preventDefault()}}),c.addEventListener("mouseup",()=>{if(o&&!u&&l.getMode()==="edit"){const m=l.getAllTouchAreas().find(g=>g.id===o);m&&(l.setTouchAreaCorrect(o,!m.isCorrect),I(),N())}t=!1,e=null,o=null,u=!1}),c.addEventListener("mouseleave",()=>{t=!1,e=null,o=null,u=!1}),c.addEventListener("contextmenu",h=>{if(l.getMode()!=="edit")return;const g=h.target.getAttribute("data-id");g&&(l.deleteTouchArea(g),I(),N(),h.preventDefault())})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{Q(),Z(),D()}):(Q(),Z(),D());
